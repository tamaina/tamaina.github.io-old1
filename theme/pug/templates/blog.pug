extends ../templates/default.pug

block preset
  - 
    let mainHeaderStyle = ""
    if(page.attributes.thumbnail) {
      mainHeaderStyle = `background-image: url("${site.url.path}${page.attributes.thumbnail}");`
    } else {
      mainHeaderStyle = `background-color: #212121;`
    }

    let pagesPast = pages.filter(
          function(el, i, array){
            let elem_mtime = new Date(el.stats.mtime)
            let page_mtime = new Date(page.stats.mtime)

            return ( elem_mtime.getTime() < page_mtime.getTime() && el.attributes.layout == page.attributes.layout )
          })
      , pagesFuture = pages.filter(
          function(el, i, array){
            let elem_mtime = new Date(el.stats.mtime)
            let page_mtime = new Date(page.stats.mtime)

            return (elem_mtime.getTime() > page_mtime.getTime() && el.attributes.layout == page.attributes.layout )
          })
    function mapping_pages_mtime(el, index, array){
      let elem_mdate = new Date(el.stats.mtime) 
      return elem_mdate.getTime()
    }

    let pagePrev_mTime = Math.max.apply(null,pagesPast.map(mapping_pages_mtime))
      , pageNext_mTime = Math.min.apply(null,pagesFuture.map(mapping_pages_mtime))

    let pagesPrev = pagesPast.filter(
          function(el, i, array){
            let elem_mtime = new Date(el.stats.mtime)

            return (elem_mtime.getTime() == pagePrev_mTime)
          }
        )
      , pagesNext = pagesFuture.filter(
          function(el, i, array){
            let elem_mtime = new Date(el.stats.mtime)

            return (elem_mtime.getTime() == pageNext_mTime)
          }
        )
    const pagePrev = pagesPrev[0]
    const pageNext = pagesNext[0]

block main
  #main.pb-5.pt-0
    article
      header#main_header(style= mainHeaderStyle).text-light
        .container
          - let mtime = new Date(page.stats.mtime)
          h1#blogheader_top= page.attributes.title
          div.mb-1
            +fa("clock-o")
            time(datetime=page.stats.mtime) #{mtime.getFullYear()}年#{mtime.getMonth()+1}月#{mtime.getDate()}日 #{`00${mtime.getHours()}`.slice(-2)}:#{`00${mtime.getMinutes()}`.slice(-2)}
          div.mb-3
            +fa("folder-open")
            if(page.attributes.categories)
              each category in page.attributes.categories
                span.badge.badge-success= category
                |  
            else
              | なし
            | &emsp;
            +fa("tags")
            if(page.attributes.tags)
              each tag in page.attributes.tags
                span.badge.badge-secondary= tag
                |  
            else
              | なし
          div.mb-3#blogheader_description= page.attributes.description
          
        #blogheader_footer.d-flex.flex-wrap
          if(pagePrev)
            a(href=`${site.url.path}${pagePrev.attributes.permalink}`)#blogheader_prev.py-3.text-light
              .container 前: #{pagePrev.attributes.title}
          if(pageNext) 
            a(href=`${site.url.path}${pageNext.attributes.permalink}`)#blogheader_next.py-3.text-light
              .container 次: #{pageNext.attributes.title}

      .container.pt-3
        != main_html