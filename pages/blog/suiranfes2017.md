---
title: 高校の文化祭の2017年版のウェブサイト
description: あの頃はまだ若かった。
layout: blog
category: 学校
tag: 翠巒祭
---

## 更新

◎2017/05/04 文章が雑だったのを若干修正しました  
◎2017/05/06 バージョンアップ・Barba.jsを取り入れてpjaxに  
◎2017/06/13 Service Worker部分だけ別立てで記事とリポジトリ作成  
◎2017/08/10 記事の名前を変えてみる、あと色々直す  
◎2017/08/19 grunt-fontmin-exをnpmにリリース  

## 初めに

殴り書きで何言ってるかわかりませんが私が何やったかわからなくなってきただけです。1人月ぐらい費やした気がします。

MDBuilderの原点です。MDBuilderはこのサイトから汎用できるように作り始めました。

qiitaに投稿した記事の転載です。

## なぜ紹介する？

無駄に時間を掛けたのと、Googleとかが提唱するウェブページの新たなあり方がわかりそうだから。

## とりあえず

まずリポジトリを晒すと早いんだなぁ

https://github.com/suiranfes/2017.suiranfes.com

★Readmeに大体のことが書いてあるから、読んでね、てかReadmeあればぶっちゃけこの記事要らないくないか……？  
どっかからそのまんま引っ張ってきたソースコードあるらしいけど、どっから引っ張ってきたか書いてない、恐るべし昔の俺(怒られる前になんとかしろ感)

と、とりあえず現物を見ると早いと思います

https://2017.suiranfes.com/

## どんなサイトなのか

**Node.js**の**Grunt**でビルドされて**Pug**と**Stylus**で書かれていてjsは**Browserify**と**Uglify**されて**WebFont**と**Bootstrap4.0.0-alpha.6**と独自で作った和紙っぽい背景が多用されていて**RSS2.0**や**Service Worker**や**Web Notification**が設定されているmixhost上に置かれている**静的サイト**

Googleのいうところの**PWA**

適切に設定されればgithubでも動く、というか本来githubで動かすはずだったがmixhostに課金した。mixhostにした結果、CloudFlareが御用になった。

いちいちビルドする必要があるけど、Travis-CIでビルド結果をpushしたりもできた(ftpするので今は切ってる、っていうか完全にお遊び機能……)

ビルドごとにフォントをサブセットするので読み込みが非常に軽い(ただし作成が時間かかる、そして文字数が多いと変わらない感じ)。

表示上唯一の欠点はIEで動かないこと(どういうわけかレンダリングがぼろぼろになる、なんだこれは……)

### 技術的な殴り書き

もはや説明する気になれない(本が書けそう、まあブログ記事とかリファレンスとかの盗用の塊なだけなんだけど)  
いろんなサイトを読み漁った結果ちゃんと参照できてないです。どうすんだよ。

## ひとつづつ見ていこう

とは言ったものの**Gruntfile.jsを全部読むのが近道**

### jsonによる情報管理

ねえねえ、文化祭で扱う情報量ってばかにならないんだよ？っていうわけで、とりあえずそういうことをしてみる。**extend**ってそんな便利なもんあったのかよ感。

って感じで、PugとStylusで操作できるようにイベントや食べ物、サイトの情報を全てjson(連想配列)で流します。

config内のすべてのファイルを統合したhttps://2017.suiranfes.com/api/v1/index.jsonが利用可能です。

### bootstrap 4.0.0-alpha.6

1月ぐらいから弄っている立派なお友達です。

いろんなものの余白が全部なくなって、p-2とかpt-2とかp-autoとかm-2とか指定しないといけないみたいです。**ドチャクソ便利だわこれ。**

もとをたどるとHonokaから派生してv4-alpha.6を載っけてSuikaって名付けたやつだけど、WebFontとか完全にうち仕様でscssでビルドなんて知るかっていう感じのやつです。ごめんなさい。これもうHonokaどころじゃないし、Honokaって完全移植できてないのねー。あと、HonokaのStylus化にも取り組みたいところ(変数共有的な意味が強い、あと必要な機能の無効化、そしてさらに吐き出したしたCSSの省力化が期待できる云々)

デザインとかビルドとかはさておき、CSSとDocumentationの仕様対応してるのが重要です。と言うより、v4.0.0-alpha.5から突然変わってかなり焦りました。

### BrowserifyとUglify

Browserifyの書き方でつまづいたけど、今ちゃんと動いてます(ドキュメント少なすぎぃ)

書き方に困ってる人は参考にしてほしいかな(`src/js`の、メインはmain.js)

### WebFont

grunt-fontminを利用。ちょっとだけ弄ってwoff2とttfが出てくるようになりました。  
~~Gruntfile.jsの前半が思いっきりfontminに割かれてます(別にして公開しろって?めんどい、だれか登録して)~~  
→npmに上げた(https://www.npmjs.com/package/grunt-fontmin-ex)

これやると[源真ゴシック(源ノ角フォント=Source Han Sans、の改良版)](http://jikasei.me/font/genshin/)のサイズがめっちゃ小さくなる。Google早期アクセスもTypekitも知るかって感じになります。やばいです。

ちなみに手法は変化していて、「とりあえず全部読ましとく(1MBが3ウェイトで3MB)→Typekit導入→grunt-fontmin」と変化しています。  
まあ大まかな流れなので、細かいのはソース解読してね(ぇ

### Service Worker

別立てで記事作成 http://qiita.com/aqz/items/804a2d9e38dfb82a33be

## 結局何が言いたい

文化祭のHPにしては先進的だろう？そうであろう？(そういうのを変態と言う？)

以上、Node.jsはサイトビルダー(ただしgrunt)
